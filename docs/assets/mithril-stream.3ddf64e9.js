r.SKIP={};r.lift=v;r.scan=h;r.merge=d;r.combine=p;r.scanMerge=l;r["fantasy-land/of"]=r;var s=!1;Object.defineProperty(r,"HALT",{get:function(){return s||console.log("HALT is deprecated and has been renamed to SKIP"),s=!0,r.SKIP}});function r(t){var e=[],u=[];function n(i){return arguments.length&&i!==r.SKIP&&(t=i,g(n)&&(n.changing(),n.state="active",e.forEach(function(a,o){a(u[o](t))}))),t}n.constructor=r,n.state=arguments.length&&t!==r.SKIP?"active":"pending",n.parents=[],n.changing=function(){g(n)&&(n.state="changing"),e.forEach(function(i){i.changing()})},n.map=function(i,a){var o=n.state==="active"&&a!==r.SKIP?r(i(t)):r();return o.parents.push(n),e.push(o),u.push(i),o};var c;function f(){return c=r(),c.map(function(i){return i===!0&&(n.parents.forEach(function(a){a.unregisterChild(n)}),n.state="ended",n.parents.length=e.length=u.length=0),i}),c}return n.toJSON=function(){return t!=null&&typeof t.toJSON=="function"?t.toJSON():t},n["fantasy-land/map"]=n.map,n["fantasy-land/ap"]=function(i){return p(function(a,o){return a()(o())},[i,n])},n.unregisterChild=function(i){var a=e.indexOf(i);a!==-1&&(e.splice(a,1),u.splice(a,1))},Object.defineProperty(n,"end",{get:function(){return c||f()}}),n}function p(t,e){var u=e.every(function(a){if(a.constructor!==r)throw new Error("Ensure that each item passed to stream.combine/stream.merge/lift is a stream");return a.state==="active"}),n=u?r(t.apply(null,e.concat([e]))):r(),c=[],f=e.map(function(a){return a.map(function(o){return c.push(a),(u||e.every(function(m){return m.state!=="pending"}))&&(u=!0,n(t.apply(null,e.concat([c]))),c=[]),o},r.SKIP)}),i=n.end.map(function(a){a===!0&&(f.forEach(function(o){o.end(!0)}),i.end(!0))});return n}function d(t){return p(function(){return t.map(function(e){return e()})},t)}function h(t,e,u){var n=u.map(function(c){var f=t(e,c);return f!==r.SKIP&&(e=f),f});return n(e),n}function l(t,e){var u=t.map(function(c){return c[0]}),n=p(function(){var c=arguments[arguments.length-1];return u.forEach(function(f,i){c.indexOf(f)>-1&&(e=t[i][1](e,f()))}),e},u);return n(e),n}function v(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);return d(e).map(function(u){return t.apply(void 0,u)})}function g(t){return t.state==="pending"||t.state==="active"||t.state==="changing"}export{r as S};
